<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ¤– Selenium API Tester (rc api)</title>
    <style>
        /* ç»§æ‰¿ä¹‹å‰ä¼˜åŒ–çš„â€œèˆ’é€‚ä¸æ´»è·ƒâ€é£æ ¼ */
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            padding: 30px;
            background-color: #F0F4F8;
            color: #333;
        }
        .container {
            max-width: 900px;
            margin: 0 auto;
            background: #FFFFFF;
            padding: 40px;
            border-radius: 12px;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
        }
        .section-title {
            color: #2196F3;
            border-bottom: 2px solid #E0E0E0;
            padding-bottom: 8px;
            margin-top: 30px;
            margin-bottom: 25px;
            font-weight: 600;
        }
        .param-group {
            margin-bottom: 15px;
            display: flex;
            align-items: center;
        }
        .param-group label {
            flex-basis: 140px;
            font-weight: 500;
            color: #555;
            text-align: right;
            padding-right: 15px;
        }
        .param-group input, .param-group select {
            flex-grow: 1;
            padding: 10px;
            border: 1px solid #D0D0D0;
            border-radius: 8px;
            margin-right: 15px;
            transition: border-color 0.3s;
        }
        .param-group input:focus, .param-group select:focus {
            border-color: #4CAF50;
            outline: none;
            box-shadow: 0 0 5px rgba(76, 175, 80, 0.2);
        }
        .required::after {
            content: " *";
            color: red;
        }
        #api-select {
            width: 100%;
            padding: 12px;
            font-size: 16px;
            border-color: #2196F3;
        }
        button {
            padding: 14px 30px;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 17px;
            font-weight: bold;
            transition: background-color 0.3s, transform 0.1s;
            width: 100%;
            margin-top: 30px;
        }
        button:hover {
            background-color: #388E3C;
            transform: translateY(-1px);
        }
        #result-area {
            margin-top: 20px;
            padding: 20px;
            border: 1px solid #D0D0D0;
            background-color: #F8F8F8;
            border-radius: 8px;
            white-space: pre-wrap;
            min-height: 150px;
            font-family: 'Consolas', 'Courier New', monospace;
            font-size: 0.9em;
            color: #000;
        }
        #request-body-container label {
             flex-basis: 220px;
        }
    </style>
</head>
<body>

<div class="container">
    <h1>ğŸ¤– render crawler API</h1>

    <h2 class="section-title">ğŸ’¡ æ¥å£é…ç½®</h2>
    <div class="param-group">
        <label for="base-url-input" class="required">åŸºç¡€ URL:</label>
        <input type="text" id="base-url-input" >
    </div>

    <div class="param-group">
        <label for="api-select">é€‰æ‹©æ¥å£:</label>
        <select id="api-select" onchange="updateForm()">
            <option value="" disabled selected>-- è¯·é€‰æ‹©ä¸€ä¸ª API æ¥å£ --</option>
            <option value="/web/css">/web/css (Csså®šä½)</option>
            <option value="/web/xpath">/web/xpath (Xpathå®šä½)</option>
            <option value="/web/time">/web/time (Time)</option>
        </select>
    </div>

    <h2 class="section-title">ğŸ”‘ è¯·æ±‚ä½“å‚æ•° </h2>
    <div id="request-body-container">
        <p style="color: #666; text-align: center;">è¯·å…ˆé€‰æ‹©ä¸€ä¸ª API æ¥å£...</p>
    </div>

    <button id="btbt" onclick="sendRequest()">âœ¨ å‘èµ· POST è¯·æ±‚</button>

    <h2 class="section-title">âœ… ç»“æœåé¦ˆåŒºåŸŸ</h2>
    <div id="result-area"></div>

</div>

<script>
    // å®šä¹‰ API è§„èŒƒï¼ˆä¸ä¹‹å‰ç›¸åŒï¼‰
    const API_SPEC = {
        "/web/css": {
            model: "mods.Css",
            path: "/web/css",
            required: ["css", "url", "waitTime"]
        },
        "/web/xpath": {
            model: "mods.Xpath",
            path: "/web/xpath",
            required: ["xpath", "url", "waitTime"]
        },
        "/web/time": {
            model: "mods.WebReq",
            path: "/web/time",
            required: ["url", "waitTime"]
        }
    };

    const DEFINITIONS = {
        "mods.Css": {
            css: { desc: "cssé€‰æ‹©å™¨", type: "string", default:"#app"},
            url: { desc: "å¿…é¡»æºå¸¦httpå¤´", type: "string", default: "https://www.bilibili.com" }, // ç¤ºä¾‹é»˜è®¤ URL
            waitTime: { desc: "ç­‰å¾…æ—¶é—´ (ç§’)", type: "integer", default: 10 },
            pageLoadStrategy: { desc: "åŠ è½½ç±»å‹", enum: ["normal", "eager", "none"], default: "normal" },
            proxyPoolType: { desc: "ä»£ç†ç±»å‹", enum: ["off", "cn", "intl"], default: "off" }
        },
        "mods.Xpath": {
            xpath: { desc: "xpathé€‰æ‹©å™¨", type: "string",default:"//*[@id=\"app\"]" },
            url: { desc: "å¿…é¡»æºå¸¦httpå¤´", type: "string", default: "https://www.bilibili.com" },
            waitTime: { desc: "ç­‰å¾…æ—¶é—´ (ç§’)", type: "integer", default: 10 },
            pageLoadStrategy: { desc: "åŠ è½½ç±»å‹", enum: ["normal", "eager", "none"], default: "normal" },
            proxyPoolType: { desc: "ä»£ç†ç±»å‹", enum: ["off", "cn", "intl"], default: "off" }
        },
        "mods.WebReq": {
            url: { desc: "å¿…é¡»æºå¸¦httpå¤´", type: "string", default: "https://www.baidu.com" },
            waitTime: { desc: "ç­‰å¾…æ—¶é—´ (ç§’)", type: "integer", default: 10 },
            pageLoadStrategy: { desc: "åŠ è½½ç±»å‹", enum: ["normal", "eager", "none"], default: "normal" },
            proxyPoolType: { desc: "ä»£ç†ç±»å‹", enum: ["off", "cn", "intl"], default: "off" }
        }
    };

    const container = document.getElementById('request-body-container');

    /**
     * æ ¹æ®é€‰ä¸­çš„ API åŠ¨æ€æ›´æ–°è¡¨å•
     */
    function updateForm() {
        const selectedPath = document.getElementById('api-select').value;
        if (!selectedPath) return;

        const spec = API_SPEC[selectedPath];
        const modelDef = DEFINITIONS[spec.model];
        container.innerHTML = '';

        for (const key in modelDef) {
            const prop = modelDef[key];
            const isRequired = spec.required.includes(key);

            const group = document.createElement('div');
            group.className = 'param-group';

            const label = document.createElement('label');
            label.textContent = `${key} (${prop.desc})`;
            if (isRequired) {
                label.classList.add('required');
            }

            let inputElement;
            if (prop.enum) {
                // æšä¸¾ç±»å‹ï¼Œåˆ›å»ºé€‰æ‹©æ¡†
                inputElement = document.createElement('select');
                prop.enum.forEach(val => {
                    const option = document.createElement('option');
                    option.value = val;
                    option.textContent = val;
                    if (val === prop.default) {
                        option.selected = true;
                    }
                    inputElement.appendChild(option);
                });
            } else {
                // æ–‡æœ¬è¾“å…¥æ¡†
                inputElement = document.createElement('input');
                inputElement.type = 'text';
                inputElement.id = `input-${key}`;
                inputElement.placeholder = `${prop.desc} (${prop.type})`;
                inputElement.value = prop.default || '';
            }
            inputElement.name = key;
            inputElement.id = `input-${key}`;

            group.appendChild(label);
            group.appendChild(inputElement);
            container.appendChild(group);
        }
    }

    /**
     * å‘é€ POST è¯·æ±‚
     */
    async function sendRequest() {
        const resultArea = document.getElementById('result-area');
        // ç›´æ¥ä½¿ç”¨å†™æ­»çš„ URL
        const baseUrl = document.getElementById('base-url-input').value;
        const selectedPath = document.getElementById('api-select').value;

        const btbt = document.getElementById('btbt');


        if (!baseUrl || !selectedPath) {
            resultArea.innerHTML = '<span style="color: red;">âŒ è¯·é€‰æ‹©ä¸€ä¸ª API æ¥å£ï¼</span>';
            return;
        }

        const fullUrl = `${baseUrl}${selectedPath}`;
        const requestBody = {};
        let missingRequired = false;

        // æ”¶é›†è¡¨å•æ•°æ®
        const spec = API_SPEC[selectedPath];
        container.querySelectorAll('[name]').forEach(input => {
            const key = input.name;
            let value = input.value.trim();

            if (spec.required.includes(key) && !value) {
                missingRequired = true;
            }

            // å¤„ç†ç±»å‹è½¬æ¢
            const type = DEFINITIONS[spec.model][key].type;
            if (type === 'integer' && value) {
                value = parseInt(value, 10);
                if (isNaN(value)) {
                    // å¦‚æœè½¬æ¢å¤±è´¥ï¼Œè®¾ä¸ºç©ºæˆ–ä¿ç•™å­—ç¬¦ä¸²ä»¥ä¾¿åç«¯å¤„ç†
                    value = null;
                }
            }

            if (value !== null && value !== '') {
                requestBody[key] = value;
            }
        });

        if (missingRequired) {
            resultArea.innerHTML = '<span style="color: red;">âŒ è¯·æ±‚å¤±è´¥ï¼šå¿…å¡«å­—æ®µä¸èƒ½ä¸ºç©ºï¼</span>';
            return;
        }

        resultArea.innerHTML = `å¤„ç†ä¸­...`;

        try {

            btbt.setAttribute("disabled", true);
            btbt.style.backgroundColor = "gray";


            const response = await fetch(fullUrl, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(requestBody)
            });

            const status = response.status;
            let dataText;

            try {
                // å°è¯•è¯»å–å“åº”ä½“ä¸º JSON æˆ–æ–‡æœ¬
                const json = await response.json();
                dataText = JSON.stringify(json, null, 2);
            } catch (e) {
                dataText = await response.text();
            }

            const statusColor = response.ok ? 'green' : 'red';


            // 2. åˆ›å»ºä¸€ä¸ªæ–°çš„æ®µè½å…ƒç´ æ¥æ‰¿è½½å†…å®¹å’Œæ ·å¼
            const p = document.createElement('p');

            // 3. è®¾ç½®æ ·å¼
            p.style.color = statusColor;
            p.style.fontWeight = 'bold';
            // 4. ä½¿ç”¨ textContent å®‰å…¨åœ°æ’å…¥æ•°æ®
            p.textContent = dataText; // ğŸ‘ˆ å…³é”®ï¼šè¿™é‡Œ dataText è¢«è§†ä¸ºçº¯æ–‡æœ¬
            // 5. å°†å…ƒç´ æ·»åŠ åˆ°ç»“æœåŒºåŸŸ
            resultArea.appendChild(p);



        } catch (error) {

            resultArea.innerHTML = `
            <span style="color: red; font-weight: bold;">âŒ è¯·æ±‚å¤±è´¥ï¼šç½‘ç»œæˆ– CORS é”™è¯¯</span>
            --------------------------------------
            é”™è¯¯ä¿¡æ¯: ${error.message}
            è¯·æ£€æŸ¥åç«¯æœåŠ¡  æ˜¯å¦è¿è¡Œå¹¶é…ç½®äº† CORSã€‚`;
            console.error('Fetch Error:', error);
        }finally {
            // btbt.hidden=false
            btbt.removeAttribute("disabled");
            btbt.style.backgroundColor = "#388E3C";

        }

    }


    function initializeBaseUrl() {
        const baseUrlInput = document.getElementById('base-url-input');

        // è·å–å½“å‰é¡µé¢çš„åè®®ã€ä¸»æœºåå’Œç«¯å£ (ä¾‹å¦‚: http://localhost:8080)
        const currentOrigin = window.location.origin;

        // è®¾ç½®åŸºç¡€ URLã€‚å¦‚æœæ‚¨çš„åç«¯ API è¿è¡Œåœ¨ä¸åŒçš„ç«¯å£ï¼Œå¯èƒ½éœ€è¦åœ¨æ­¤å¤„ä¿®æ”¹ã€‚
        // å‡è®¾ API å’Œå‰ç«¯è¿è¡Œåœ¨åŒä¸€ä¸ª Originï¼Œä½† API è·¯å¾„å¯èƒ½ä¸åŒã€‚
        // å¦‚æœæ‚¨æƒ³å¼ºåˆ¶ä½¿ç”¨ä¸€ä¸ªä¸åŒçš„ç«¯å£ï¼Œä¾‹å¦‚ 10034ï¼š
        // const customUrl = `${window.location.protocol}//${window.location.hostname}:10034`;

        baseUrlInput.value = currentOrigin;
    }
    initializeBaseUrl()

</script>

</body>
</html>